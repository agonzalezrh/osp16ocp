- block:
  - name: set is_haproxy_bootstrap_node fact
    set_fact: is_haproxy_bootstrap_node={{haproxy_short_bootstrap_node_name|lower
      == ansible_facts['hostname']|lower}}
    tags: common
    when:
    - haproxy_short_bootstrap_node_name|default(false)
  name: Set HAProxy upgrade facts
- name: Ensure the cluster converge back even in case of schema change
  shell: pcs resource cleanup ovn-dbs-bundle
  when:
  - step|int == 5
- name: Remove the ban
  shell: pcs resource clear ovn-dbs-bundle
  when:
  - step|int == 5
- block:
  - name: Get the present image used by ovn-dbs-bundle
    register: ovn_dbs_current_image
    shell: pcs resource config ovn-dbs-bundle | grep -Eo 'image=[^ ]+' | awk -F= '{print
      $2;}'
  - block:
    - command: pcs resource bundle update ovn-dbs-bundle container image={{ovn_dbs_image_latest}}
      name: Update the ovn-dbs-bundle to use the new container image name
    when:
    - ovn_dbs_current_image.stdout != ovn_dbs_image_latest
  name: Update ovn-dbs-bundle resource to use pcmklatest tag image if not used
  vars:
    ovn_dbs_image_latest: cluster.common.tag/openstack-ovn-northd:pcmklatest
  when:
  - step|int == 5
  - ovn_dbs_short_bootstrap_node_name|lower == ansible_facts['hostname']|lower
- name: Check swift containers log folder/symlink exists
  register: swift_log_link
  stat:
    path: /var/log/containers/swift
- file:
    path: /var/log/containers/swift
    state: absent
  name: Delete if symlink
  when: swift_log_link.stat.islnk is defined and swift_log_link.stat.islnk
- name: Set boolean skip_package_update
  set_fact:
    skip_package_update: false
